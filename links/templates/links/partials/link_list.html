<div id="link-list"
     class="space-y-4"
     hx-get="/"
     hx-select="#link-list"
     hx-swap="outerHTML"
     hx-trigger="refresh-links from:body{% if has_pending %}, load delay:2s{% endif %}">
     {% if has_pending %}
  <div class="bg-indigo-50 border-l-4 border-indigo-500 p-4 mb-4 rounded-r shadow-sm animate-pulse">
      <div class="flex items-center">
          <div class="flex-shrink-0">
            <svg class="animate-spin h-5 w-5 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          </div>
          <div class="ml-3">
              <p class="text-sm text-indigo-700 font-bold">
                  ğŸ¤– AIê°€ ë‰´ìŠ¤ë¥¼ ì½ê³  ë¶„ì„í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤... (ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”)
              </p>
          </div>
      </div>
  </div>
  {% endif %}

  {% for link in links %}
  <div class="bg-white p-6 rounded-lg shadow border-l-4 transition duration-500 ease-in-out

    {% if link.status == 'COMPLETED' %}
      border-green-500

    {% elif link.status == 'FAILED' %}
      border-red-500

    {% elif link.status == 'PENDING' or link.status == 'PROCESSING' %}
      border-blue-400 bg-blue-50 animate-pulse

    {% elif link.status == 'RECOMMENDED' and link.recommendation_type == 'PERSONAL' %}
      border-purple-500

    {% elif link.status == 'RECOMMENDED' and link.recommendation_type == 'EXPLORE' %}
      border-sky-500

    {% elif link.status == 'RECOMMENDED' %}
      border-indigo-500

    {% else %}
      border-yellow-500
    {% endif %}
  ">

    <div class="flex justify-between items-start mb-3">
      <span class="text-xs font-bold px-2 py-1 rounded

        {% if link.status == 'COMPLETED' %}
          bg-green-100 text-green-800

        {% elif link.status == 'FAILED' %}
          bg-red-100 text-red-800

        {% elif link.status == 'PENDING' or link.status == 'PROCESSING' %}
          bg-blue-200 text-blue-800

        {% elif link.status == 'RECOMMENDED' and link.recommendation_type == 'PERSONAL' %}
          bg-purple-100 text-purple-800

        {% elif link.status == 'RECOMMENDED' and link.recommendation_type == 'EXPLORE' %}
          bg-sky-100 text-sky-800

        {% elif link.status == 'RECOMMENDED' %}
          bg-indigo-100 text-indigo-800

        {% else %}
          bg-yellow-100 text-yellow-800
        {% endif %}
      ">

        {% if link.status == 'RECOMMENDED' %}
          {% if link.recommendation_type == 'PERSONAL' %}
            AIì¶”ì²œ Â· ì·¨í–¥
          {% elif link.recommendation_type == 'EXPLORE' %}
            AIì¶”ì²œ Â· íƒí—˜
          {% else %}
            AIì¶”ì²œ
          {% endif %}
        
        {% elif link.status == 'COMPLETED' %}
          READ 
        {% elif link.status == 'PENDING' %}
          â³ ëŒ€ê¸° ì¤‘
        {% elif link.status == 'PROCESSING' %}
          âš™ï¸ ë¶„ì„ ì¤‘
        {% else %}
          {{ link.status }}
        {% endif %}
      </span>

      <span class="text-xs text-gray-400">
        {{ link.created_at|date:"Y-m-d H:i" }}
      </span>
    </div>

    <div class="flex flex-col-reverse sm:flex-row gap-4 justify-between">
      <div class="flex-1 min-w-0">

        <h3 class="text-xl font-bold mb-2 break-keep">

          {% if link.status == 'RECOMMENDED' %}
            <a href="{% url 'convert_recommendation' link.id %}"
               target="_blank"
               class="
                {% if link.recommendation_type == 'PERSONAL' %}
                  text-purple-700 hover:text-purple-900
                {% elif link.recommendation_type == 'EXPLORE' %}
                  text-sky-700 hover:text-sky-900
                {% else %}
                  text-indigo-700 hover:text-indigo-900
                {% endif %}
                hover:underline
               ">
              {{ link.title|default:link.url }}
            </a>
          
          {% elif link.status == 'PENDING' or link.status == 'PROCESSING' %}
             <span class="text-gray-500 cursor-wait">
               {{ link.url|truncatechars:50 }} (ë¶„ì„ ì¤‘...)
             </span>

          {% else %}
            <a href="{{ link.url }}" target="_blank" class="hover:text-blue-600 hover:underline">
              {{ link.title|default:link.url }}
            </a>
          {% endif %}
        </h3>

        {% if link.status == 'RECOMMENDED' %}
          <p class="text-xs text-gray-500 mb-2">
            {% if link.recommendation_type == 'PERSONAL' %}
              ë‚´ê°€ ìµœê·¼ì— ì½ì€ ê¸°ì‚¬ íë¦„ê³¼ ê°€ì¥ ìœ ì‚¬í•œ ì¶”ì²œì…ë‹ˆë‹¤.
            {% elif link.recommendation_type == 'EXPLORE' %}
              ê¸°ì¡´ ê´€ì‹¬ì‚¬ë¥¼ í™•ì¥í•˜ê¸° ìœ„í•œ íƒí—˜í˜• ì¶”ì²œì…ë‹ˆë‹¤.
            {% endif %}
          </p>
        {% endif %}

        {% if link.summary %}
        <div class="bg-gray-50 p-4 rounded text-gray-700 text-sm mb-3 whitespace-pre-line animate-fade-in">
          {{ link.summary }}
        </div>
        {% endif %}

        {% if link.tags %}
        <div class="flex flex-wrap gap-2 mt-2">
          {% for tag in link.tags %}
          <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">
            #{{ tag }}
          </span>
          {% endfor %}
        </div>
        {% endif %}

        {% if link.status == 'RECOMMENDED' and not link.summary %}
        <p class="text-sm text-gray-400 mt-2">
          * í´ë¦­í•˜ë©´ ì›ë¬¸ì„ ì—´ê³  AI ìš”ì•½ ë° ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤.
        </p>
        {% endif %}
      </div>

      {% if link.image_url %}
      <div class="flex-shrink-0 sm:ml-4">
        <img src="{{ link.image_url }}"
             alt="thumbnail"
             class="w-full h-48 sm:w-32 sm:h-32 object-cover rounded-lg shadow-sm border border-gray-100"
             referrerpolicy="no-referrer"
             onerror="this.style.display='none';" />
      </div>
      {% endif %}
    </div>
  </div>

  {% empty %}
  <div class="text-center text-gray-500 py-10">
    ì•„ì§ ì €ì¥ëœ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.
  </div>
  {% endfor %}
</div>